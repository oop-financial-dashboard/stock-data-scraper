package oop.stockdataindexer.services;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import oop.stockdataindexer.Repository.BatchInsertRepository;
import oop.stockdataindexer.models.StockDailyPriceRow;
import oop.stockdataindexer.models.StockListing;
import oop.stockdataindexer.models.alphaVantage.AlphaVantageDailyPrice;
import oop.stockdataindexer.models.alphaVantage.TimeSeriesDaily;
import oop.stockdataindexer.services.postgres.InsertStockDailyPriceService;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.DriverManagerDataSource;
import org.springframework.web.client.RestTemplate;

import javax.sql.DataSource;
import java.io.IOException;
import java.sql.Date;
import java.sql.SQLException;
import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;


public class BackfillService {
    public BackfillService() {
    }

    public void backfill() throws IOException, SQLException, JsonProcessingException {
        System.out.println("BACKFILL SCRAPPER RUNNING");
        CSVReaderService x = new CSVReaderService();
//        ArrayList<StockListing> Stocks = x.readCSV("src/main/resources/listing_status.csv");
        ArrayList<StockListing> Stocks = new ArrayList<>();
        Stocks.add(new StockListing(
            "POTUS",
                "President of the United States",
                "NYSE",
                "Stock",
                "1777-07-04",
                null,
                "Active"
        ));
        Stocks.forEach((stock) -> {
            final List<StockDailyPriceRow> stockDailyPriceRowList = new ArrayList<>();
            String symbol = stock.getSymbol();
            RestTemplate restTemplate = new RestTemplate();
//            String apiKey = "2HGPQ27GH9K7PAPC";
//            String apiUrl = String.format("https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=%s&apikey=%s&outputsize=full", symbol, apiKey);
//            String test =
//            AlphaVantageDailyPrice res = restTemplate.getForObject(apiUrl, AlphaVantageDailyPrice.class);
            ObjectMapper obj = new ObjectMapper();
            AlphaVantageDailyPrice res = null;
            try {
                res = obj.readValue("{\n" +
                        "  \"Meta Data\": {\n" +
                        "    \"1. Information\": \"Daily Prices (open, high, low, close) and Volumes\",\n" +
                        "    \"2. Symbol\": \"IBM\",\n" +
                        "    \"3. Last Refreshed\": \"2023-10-16\",\n" +
                        "    \"4. Output Size\": \"Compact\",\n" +
                        "    \"5. Time Zone\": \"US/Eastern\"\n" +
                        "  },\n" +
                        "  \"Time Series (Daily)\": {\n" +
                        "    \"2023-10-16\": {\n" +
                        "      \"1. open\": \"139.2800\",\n" +
                        "      \"2. high\": \"139.7800\",\n" +
                        "      \"3. low\": \"138.5200\",\n" +
                        "      \"4. close\": \"139.2100\",\n" +
                        "      \"5. volume\": \"3361468\"\n" +
                        "    },\n" +
                        "    \"2023-10-13\": {\n" +
                        "      \"1. open\": \"139.7700\",\n" +
                        "      \"2. high\": \"140.1200\",\n" +
                        "      \"3. low\": \"138.2700\",\n" +
                        "      \"4. close\": \"138.4600\",\n" +
                        "      \"5. volume\": \"4583553\"\n" +
                        "    },\n" +
                        "    \"2023-10-12\": {\n" +
                        "      \"1. open\": \"142.5100\",\n" +
                        "      \"2. high\": \"142.9300\",\n" +
                        "      \"3. low\": \"140.9500\",\n" +
                        "      \"4. close\": \"141.2400\",\n" +
                        "      \"5. volume\": \"3921142\"\n" +
                        "    },\n" +
                        "    \"2023-10-11\": {\n" +
                        "      \"1. open\": \"142.5100\",\n" +
                        "      \"2. high\": \"143.3400\",\n" +
                        "      \"3. low\": \"142.1400\",\n" +
                        "      \"4. close\": \"143.2300\",\n" +
                        "      \"5. volume\": \"2511459\"\n" +
                        "    },\n" +
                        "    \"2023-10-10\": {\n" +
                        "      \"1. open\": \"142.6000\",\n" +
                        "      \"2. high\": \"143.4150\",\n" +
                        "      \"3. low\": \"141.7200\",\n" +
                        "      \"4. close\": \"142.1100\",\n" +
                        "      \"5. volume\": \"3015784\"\n" +
                        "    },\n" +
                        "    \"2023-10-09\": {\n" +
                        "      \"1. open\": \"142.3000\",\n" +
                        "      \"2. high\": \"142.4000\",\n" +
                        "      \"3. low\": \"140.6800\",\n" +
                        "      \"4. close\": \"142.2000\",\n" +
                        "      \"5. volume\": \"2354396\"\n" +
                        "    },\n" +
                        "    \"2023-10-06\": {\n" +
                        "      \"1. open\": \"141.4000\",\n" +
                        "      \"2. high\": \"142.9400\",\n" +
                        "      \"3. low\": \"140.1100\",\n" +
                        "      \"4. close\": \"142.0300\",\n" +
                        "      \"5. volume\": \"3511347\"\n" +
                        "    },\n" +
                        "    \"2023-10-05\": {\n" +
                        "      \"1. open\": \"140.9000\",\n" +
                        "      \"2. high\": \"141.7000\",\n" +
                        "      \"3. low\": \"140.1900\",\n" +
                        "      \"4. close\": \"141.5200\",\n" +
                        "      \"5. volume\": \"3223910\"\n" +
                        "    },\n" +
                        "    \"2023-10-04\": {\n" +
                        "      \"1. open\": \"140.3700\",\n" +
                        "      \"2. high\": \"141.2004\",\n" +
                        "      \"3. low\": \"139.9900\",\n" +
                        "      \"4. close\": \"141.0700\",\n" +
                        "      \"5. volume\": \"2637779\"\n" +
                        "    },\n" +
                        "    \"2023-10-03\": {\n" +
                        "      \"1. open\": \"140.8700\",\n" +
                        "      \"2. high\": \"141.6400\",\n" +
                        "      \"3. low\": \"140.0000\",\n" +
                        "      \"4. close\": \"140.3900\",\n" +
                        "      \"5. volume\": \"3284421\"\n" +
                        "    },\n" +
                        "    \"2023-10-02\": {\n" +
                        "      \"1. open\": \"140.0400\",\n" +
                        "      \"2. high\": \"141.4500\",\n" +
                        "      \"3. low\": \"139.8600\",\n" +
                        "      \"4. close\": \"140.8000\",\n" +
                        "      \"5. volume\": \"3275461\"\n" +
                        "    },\n" +
                        "    \"2023-09-29\": {\n" +
                        "      \"1. open\": \"142.0000\",\n" +
                        "      \"2. high\": \"142.1300\",\n" +
                        "      \"3. low\": \"139.6100\",\n" +
                        "      \"4. close\": \"140.3000\",\n" +
                        "      \"5. volume\": \"5703983\"\n" +
                        "    },\n" +
                        "    \"2023-09-28\": {\n" +
                        "      \"1. open\": \"142.1400\",\n" +
                        "      \"2. high\": \"142.2820\",\n" +
                        "      \"3. low\": \"140.2050\",\n" +
                        "      \"4. close\": \"141.5800\",\n" +
                        "      \"5. volume\": \"5783422\"\n" +
                        "    },\n" +
                        "    \"2023-09-27\": {\n" +
                        "      \"1. open\": \"143.6700\",\n" +
                        "      \"2. high\": \"143.8200\",\n" +
                        "      \"3. low\": \"141.7600\",\n" +
                        "      \"4. close\": \"143.1700\",\n" +
                        "      \"5. volume\": \"4439121\"\n" +
                        "    },\n" +
                        "    \"2023-09-26\": {\n" +
                        "      \"1. open\": \"145.5100\",\n" +
                        "      \"2. high\": \"146.1700\",\n" +
                        "      \"3. low\": \"143.0201\",\n" +
                        "      \"4. close\": \"143.2400\",\n" +
                        "      \"5. volume\": \"4824654\"\n" +
                        "    },\n" +
                        "    \"2023-09-25\": {\n" +
                        "      \"1. open\": \"146.5700\",\n" +
                        "      \"2. high\": \"147.4300\",\n" +
                        "      \"3. low\": \"146.2500\",\n" +
                        "      \"4. close\": \"146.4800\",\n" +
                        "      \"5. volume\": \"2694245\"\n" +
                        "    },\n" +
                        "    \"2023-09-22\": {\n" +
                        "      \"1. open\": \"147.4100\",\n" +
                        "      \"2. high\": \"148.1000\",\n" +
                        "      \"3. low\": \"146.8200\",\n" +
                        "      \"4. close\": \"146.9100\",\n" +
                        "      \"5. volume\": \"2562216\"\n" +
                        "    },\n" +
                        "    \"2023-09-21\": {\n" +
                        "      \"1. open\": \"149.0000\",\n" +
                        "      \"2. high\": \"149.2500\",\n" +
                        "      \"3. low\": \"147.3100\",\n" +
                        "      \"4. close\": \"147.3800\",\n" +
                        "      \"5. volume\": \"4944786\"\n" +
                        "    },\n" +
                        "    \"2023-09-20\": {\n" +
                        "      \"1. open\": \"148.3600\",\n" +
                        "      \"2. high\": \"151.9299\",\n" +
                        "      \"3. low\": \"148.1300\",\n" +
                        "      \"4. close\": \"149.8300\",\n" +
                        "      \"5. volume\": \"9636681\"\n" +
                        "    },\n" +
                        "    \"2023-09-19\": {\n" +
                        "      \"1. open\": \"145.0000\",\n" +
                        "      \"2. high\": \"146.7200\",\n" +
                        "      \"3. low\": \"144.6600\",\n" +
                        "      \"4. close\": \"146.5200\",\n" +
                        "      \"5. volume\": \"3945423\"\n" +
                        "    },\n" +
                        "    \"2023-09-18\": {\n" +
                        "      \"1. open\": \"145.7700\",\n" +
                        "      \"2. high\": \"146.4800\",\n" +
                        "      \"3. low\": \"145.0600\",\n" +
                        "      \"4. close\": \"145.0900\",\n" +
                        "      \"5. volume\": \"2508062\"\n" +
                        "    },\n" +
                        "    \"2023-09-15\": {\n" +
                        "      \"1. open\": \"147.1100\",\n" +
                        "      \"2. high\": \"147.8500\",\n" +
                        "      \"3. low\": \"145.5300\",\n" +
                        "      \"4. close\": \"145.9900\",\n" +
                        "      \"5. volume\": \"6234033\"\n" +
                        "    },\n" +
                        "    \"2023-09-14\": {\n" +
                        "      \"1. open\": \"147.3800\",\n" +
                        "      \"2. high\": \"147.7300\",\n" +
                        "      \"3. low\": \"146.4800\",\n" +
                        "      \"4. close\": \"147.3500\",\n" +
                        "      \"5. volume\": \"2723200\"\n" +
                        "    },\n" +
                        "    \"2023-09-13\": {\n" +
                        "      \"1. open\": \"145.9500\",\n" +
                        "      \"2. high\": \"146.9800\",\n" +
                        "      \"3. low\": \"145.9200\",\n" +
                        "      \"4. close\": \"146.5500\",\n" +
                        "      \"5. volume\": \"2627999\"\n" +
                        "    },\n" +
                        "    \"2023-09-12\": {\n" +
                        "      \"1. open\": \"147.9200\",\n" +
                        "      \"2. high\": \"148.0000\",\n" +
                        "      \"3. low\": \"145.8000\",\n" +
                        "      \"4. close\": \"146.3000\",\n" +
                        "      \"5. volume\": \"4457695\"\n" +
                        "    },\n" +
                        "    \"2023-09-11\": {\n" +
                        "      \"1. open\": \"148.5700\",\n" +
                        "      \"2. high\": \"148.7800\",\n" +
                        "      \"3. low\": \"147.5800\",\n" +
                        "      \"4. close\": \"148.3800\",\n" +
                        "      \"5. volume\": \"3273720\"\n" +
                        "    },\n" +
                        "    \"2023-09-08\": {\n" +
                        "      \"1. open\": \"147.3500\",\n" +
                        "      \"2. high\": \"148.5900\",\n" +
                        "      \"3. low\": \"147.2600\",\n" +
                        "      \"4. close\": \"147.6800\",\n" +
                        "      \"5. volume\": \"3722927\"\n" +
                        "    },\n" +
                        "    \"2023-09-07\": {\n" +
                        "      \"1. open\": \"148.1300\",\n" +
                        "      \"2. high\": \"148.7800\",\n" +
                        "      \"3. low\": \"147.4000\",\n" +
                        "      \"4. close\": \"147.5200\",\n" +
                        "      \"5. volume\": \"3333040\"\n" +
                        "    },\n" +
                        "    \"2023-09-06\": {\n" +
                        "      \"1. open\": \"147.6600\",\n" +
                        "      \"2. high\": \"148.3300\",\n" +
                        "      \"3. low\": \"147.1200\",\n" +
                        "      \"4. close\": \"148.0600\",\n" +
                        "      \"5. volume\": \"2932203\"\n" +
                        "    },\n" +
                        "    \"2023-09-05\": {\n" +
                        "      \"1. open\": \"147.9100\",\n" +
                        "      \"2. high\": \"149.0000\",\n" +
                        "      \"3. low\": \"147.5719\",\n" +
                        "      \"4. close\": \"148.1300\",\n" +
                        "      \"5. volume\": \"3731281\"\n" +
                        "    },\n" +
                        "    \"2023-09-01\": {\n" +
                        "      \"1. open\": \"147.2600\",\n" +
                        "      \"2. high\": \"148.1000\",\n" +
                        "      \"3. low\": \"146.9200\",\n" +
                        "      \"4. close\": \"147.9400\",\n" +
                        "      \"5. volume\": \"2727796\"\n" +
                        "    },\n" +
                        "    \"2023-08-31\": {\n" +
                        "      \"1. open\": \"146.9400\",\n" +
                        "      \"2. high\": \"147.7275\",\n" +
                        "      \"3. low\": \"146.5400\",\n" +
                        "      \"4. close\": \"146.8300\",\n" +
                        "      \"5. volume\": \"3885949\"\n" +
                        "    },\n" +
                        "    \"2023-08-30\": {\n" +
                        "      \"1. open\": \"146.4200\",\n" +
                        "      \"2. high\": \"146.9200\",\n" +
                        "      \"3. low\": \"145.7452\",\n" +
                        "      \"4. close\": \"146.8600\",\n" +
                        "      \"5. volume\": \"2245402\"\n" +
                        "    },\n" +
                        "    \"2023-08-29\": {\n" +
                        "      \"1. open\": \"146.3000\",\n" +
                        "      \"2. high\": \"146.7300\",\n" +
                        "      \"3. low\": \"145.6200\",\n" +
                        "      \"4. close\": \"146.4500\",\n" +
                        "      \"5. volume\": \"2778113\"\n" +
                        "    },\n" +
                        "    \"2023-08-28\": {\n" +
                        "      \"1. open\": \"145.4100\",\n" +
                        "      \"2. high\": \"146.7400\",\n" +
                        "      \"3. low\": \"145.2100\",\n" +
                        "      \"4. close\": \"146.0200\",\n" +
                        "      \"5. volume\": \"3561347\"\n" +
                        "    },\n" +
                        "    \"2023-08-25\": {\n" +
                        "      \"1. open\": \"144.1800\",\n" +
                        "      \"2. high\": \"145.4700\",\n" +
                        "      \"3. low\": \"143.5000\",\n" +
                        "      \"4. close\": \"145.3500\",\n" +
                        "      \"5. volume\": \"3660147\"\n" +
                        "    },\n" +
                        "    \"2023-08-24\": {\n" +
                        "      \"1. open\": \"143.5050\",\n" +
                        "      \"2. high\": \"144.4700\",\n" +
                        "      \"3. low\": \"143.2200\",\n" +
                        "      \"4. close\": \"143.5500\",\n" +
                        "      \"5. volume\": \"2900244\"\n" +
                        "    },\n" +
                        "    \"2023-08-23\": {\n" +
                        "      \"1. open\": \"141.7200\",\n" +
                        "      \"2. high\": \"143.4750\",\n" +
                        "      \"3. low\": \"141.5800\",\n" +
                        "      \"4. close\": \"143.4100\",\n" +
                        "      \"5. volume\": \"2559083\"\n" +
                        "    },\n" +
                        "    \"2023-08-22\": {\n" +
                        "      \"1. open\": \"142.6600\",\n" +
                        "      \"2. high\": \"143.2250\",\n" +
                        "      \"3. low\": \"141.3000\",\n" +
                        "      \"4. close\": \"141.4900\",\n" +
                        "      \"5. volume\": \"3557734\"\n" +
                        "    },\n" +
                        "    \"2023-08-21\": {\n" +
                        "      \"1. open\": \"141.4200\",\n" +
                        "      \"2. high\": \"142.3900\",\n" +
                        "      \"3. low\": \"141.1100\",\n" +
                        "      \"4. close\": \"142.2800\",\n" +
                        "      \"5. volume\": \"2937781\"\n" +
                        "    },\n" +
                        "    \"2023-08-18\": {\n" +
                        "      \"1. open\": \"140.0000\",\n" +
                        "      \"2. high\": \"141.8300\",\n" +
                        "      \"3. low\": \"139.7600\",\n" +
                        "      \"4. close\": \"141.4100\",\n" +
                        "      \"5. volume\": \"3915480\"\n" +
                        "    },\n" +
                        "    \"2023-08-17\": {\n" +
                        "      \"1. open\": \"141.0100\",\n" +
                        "      \"2. high\": \"142.6600\",\n" +
                        "      \"3. low\": \"140.6000\",\n" +
                        "      \"4. close\": \"140.6600\",\n" +
                        "      \"5. volume\": \"3742058\"\n" +
                        "    },\n" +
                        "    \"2023-08-16\": {\n" +
                        "      \"1. open\": \"141.7000\",\n" +
                        "      \"2. high\": \"142.0900\",\n" +
                        "      \"3. low\": \"140.5600\",\n" +
                        "      \"4. close\": \"140.6400\",\n" +
                        "      \"5. volume\": \"3285347\"\n" +
                        "    },\n" +
                        "    \"2023-08-15\": {\n" +
                        "      \"1. open\": \"141.5000\",\n" +
                        "      \"2. high\": \"142.3100\",\n" +
                        "      \"3. low\": \"141.2000\",\n" +
                        "      \"4. close\": \"141.8700\",\n" +
                        "      \"5. volume\": \"3656559\"\n" +
                        "    },\n" +
                        "    \"2023-08-14\": {\n" +
                        "      \"1. open\": \"143.0500\",\n" +
                        "      \"2. high\": \"143.3650\",\n" +
                        "      \"3. low\": \"141.8020\",\n" +
                        "      \"4. close\": \"141.9100\",\n" +
                        "      \"5. volume\": \"4226563\"\n" +
                        "    },\n" +
                        "    \"2023-08-11\": {\n" +
                        "      \"1. open\": \"143.1200\",\n" +
                        "      \"2. high\": \"143.4500\",\n" +
                        "      \"3. low\": \"142.2050\",\n" +
                        "      \"4. close\": \"143.1200\",\n" +
                        "      \"5. volume\": \"2526433\"\n" +
                        "    },\n" +
                        "    \"2023-08-10\": {\n" +
                        "      \"1. open\": \"143.0400\",\n" +
                        "      \"2. high\": \"144.5800\",\n" +
                        "      \"3. low\": \"142.6900\",\n" +
                        "      \"4. close\": \"143.2500\",\n" +
                        "      \"5. volume\": \"4735763\"\n" +
                        "    },\n" +
                        "    \"2023-08-09\": {\n" +
                        "      \"1. open\": \"144.9400\",\n" +
                        "      \"2. high\": \"144.9400\",\n" +
                        "      \"3. low\": \"142.3000\",\n" +
                        "      \"4. close\": \"142.4900\",\n" +
                        "      \"5. volume\": \"4073038\"\n" +
                        "    },\n" +
                        "    \"2023-08-08\": {\n" +
                        "      \"1. open\": \"145.7000\",\n" +
                        "      \"2. high\": \"146.1500\",\n" +
                        "      \"3. low\": \"144.1100\",\n" +
                        "      \"4. close\": \"145.9100\",\n" +
                        "      \"5. volume\": \"4654582\"\n" +
                        "    },\n" +
                        "    \"2023-08-07\": {\n" +
                        "      \"1. open\": \"145.0000\",\n" +
                        "      \"2. high\": \"146.5000\",\n" +
                        "      \"3. low\": \"144.9300\",\n" +
                        "      \"4. close\": \"146.1800\",\n" +
                        "      \"5. volume\": \"3438654\"\n" +
                        "    },\n" +
                        "    \"2023-08-04\": {\n" +
                        "      \"1. open\": \"145.0900\",\n" +
                        "      \"2. high\": \"146.0900\",\n" +
                        "      \"3. low\": \"143.9900\",\n" +
                        "      \"4. close\": \"144.2400\",\n" +
                        "      \"5. volume\": \"4223204\"\n" +
                        "    },\n" +
                        "    \"2023-08-03\": {\n" +
                        "      \"1. open\": \"143.7800\",\n" +
                        "      \"2. high\": \"145.2200\",\n" +
                        "      \"3. low\": \"143.3116\",\n" +
                        "      \"4. close\": \"144.4500\",\n" +
                        "      \"5. volume\": \"3952640\"\n" +
                        "    },\n" +
                        "    \"2023-08-02\": {\n" +
                        "      \"1. open\": \"142.7800\",\n" +
                        "      \"2. high\": \"144.3000\",\n" +
                        "      \"3. low\": \"142.3100\",\n" +
                        "      \"4. close\": \"144.1700\",\n" +
                        "      \"5. volume\": \"4959381\"\n" +
                        "    },\n" +
                        "    \"2023-08-01\": {\n" +
                        "      \"1. open\": \"144.2500\",\n" +
                        "      \"2. high\": \"144.4800\",\n" +
                        "      \"3. low\": \"142.1700\",\n" +
                        "      \"4. close\": \"143.3300\",\n" +
                        "      \"5. volume\": \"4798703\"\n" +
                        "    },\n" +
                        "    \"2023-07-31\": {\n" +
                        "      \"1. open\": \"143.8100\",\n" +
                        "      \"2. high\": \"144.6050\",\n" +
                        "      \"3. low\": \"143.5300\",\n" +
                        "      \"4. close\": \"144.1800\",\n" +
                        "      \"5. volume\": \"6138902\"\n" +
                        "    },\n" +
                        "    \"2023-07-28\": {\n" +
                        "      \"1. open\": \"143.4400\",\n" +
                        "      \"2. high\": \"143.9500\",\n" +
                        "      \"3. low\": \"142.8500\",\n" +
                        "      \"4. close\": \"143.4500\",\n" +
                        "      \"5. volume\": \"6686627\"\n" +
                        "    },\n" +
                        "    \"2023-07-27\": {\n" +
                        "      \"1. open\": \"142.3000\",\n" +
                        "      \"2. high\": \"143.3800\",\n" +
                        "      \"3. low\": \"141.9000\",\n" +
                        "      \"4. close\": \"142.9700\",\n" +
                        "      \"5. volume\": \"6331563\"\n" +
                        "    },\n" +
                        "    \"2023-07-26\": {\n" +
                        "      \"1. open\": \"140.4400\",\n" +
                        "      \"2. high\": \"141.2500\",\n" +
                        "      \"3. low\": \"139.8800\",\n" +
                        "      \"4. close\": \"141.0700\",\n" +
                        "      \"5. volume\": \"4046441\"\n" +
                        "    },\n" +
                        "    \"2023-07-25\": {\n" +
                        "      \"1. open\": \"139.4200\",\n" +
                        "      \"2. high\": \"140.4300\",\n" +
                        "      \"3. low\": \"139.0403\",\n" +
                        "      \"4. close\": \"140.3300\",\n" +
                        "      \"5. volume\": \"3770813\"\n" +
                        "    },\n" +
                        "    \"2023-07-24\": {\n" +
                        "      \"1. open\": \"139.3500\",\n" +
                        "      \"2. high\": \"140.1200\",\n" +
                        "      \"3. low\": \"138.7788\",\n" +
                        "      \"4. close\": \"139.5400\",\n" +
                        "      \"5. volume\": \"3475442\"\n" +
                        "    },\n" +
                        "    \"2023-07-21\": {\n" +
                        "      \"1. open\": \"138.2100\",\n" +
                        "      \"2. high\": \"139.7799\",\n" +
                        "      \"3. low\": \"137.7600\",\n" +
                        "      \"4. close\": \"138.9400\",\n" +
                        "      \"5. volume\": \"5858741\"\n" +
                        "    },\n" +
                        "    \"2023-07-20\": {\n" +
                        "      \"1. open\": \"137.1900\",\n" +
                        "      \"2. high\": \"140.3200\",\n" +
                        "      \"3. low\": \"136.5600\",\n" +
                        "      \"4. close\": \"138.3800\",\n" +
                        "      \"5. volume\": \"10896330\"\n" +
                        "    },\n" +
                        "    \"2023-07-19\": {\n" +
                        "      \"1. open\": \"135.5300\",\n" +
                        "      \"2. high\": \"136.4500\",\n" +
                        "      \"3. low\": \"135.1900\",\n" +
                        "      \"4. close\": \"135.4800\",\n" +
                        "      \"5. volume\": \"5519992\"\n" +
                        "    },\n" +
                        "    \"2023-07-18\": {\n" +
                        "      \"1. open\": \"134.7100\",\n" +
                        "      \"2. high\": \"135.9500\",\n" +
                        "      \"3. low\": \"134.2900\",\n" +
                        "      \"4. close\": \"135.3600\",\n" +
                        "      \"5. volume\": \"3852058\"\n" +
                        "    },\n" +
                        "    \"2023-07-17\": {\n" +
                        "      \"1. open\": \"133.2600\",\n" +
                        "      \"2. high\": \"134.6100\",\n" +
                        "      \"3. low\": \"133.1000\",\n" +
                        "      \"4. close\": \"134.2400\",\n" +
                        "      \"5. volume\": \"3168419\"\n" +
                        "    },\n" +
                        "    \"2023-07-14\": {\n" +
                        "      \"1. open\": \"133.9100\",\n" +
                        "      \"2. high\": \"133.9200\",\n" +
                        "      \"3. low\": \"132.9400\",\n" +
                        "      \"4. close\": \"133.4000\",\n" +
                        "      \"5. volume\": \"2861496\"\n" +
                        "    },\n" +
                        "    \"2023-07-13\": {\n" +
                        "      \"1. open\": \"133.5100\",\n" +
                        "      \"2. high\": \"135.0700\",\n" +
                        "      \"3. low\": \"133.3600\",\n" +
                        "      \"4. close\": \"133.9200\",\n" +
                        "      \"5. volume\": \"3221422\"\n" +
                        "    },\n" +
                        "    \"2023-07-12\": {\n" +
                        "      \"1. open\": \"135.0700\",\n" +
                        "      \"2. high\": \"135.3300\",\n" +
                        "      \"3. low\": \"132.5750\",\n" +
                        "      \"4. close\": \"132.8400\",\n" +
                        "      \"5. volume\": \"3732189\"\n" +
                        "    },\n" +
                        "    \"2023-07-11\": {\n" +
                        "      \"1. open\": \"133.6600\",\n" +
                        "      \"2. high\": \"134.5600\",\n" +
                        "      \"3. low\": \"133.2300\",\n" +
                        "      \"4. close\": \"134.4400\",\n" +
                        "      \"5. volume\": \"2925238\"\n" +
                        "    },\n" +
                        "    \"2023-07-10\": {\n" +
                        "      \"1. open\": \"131.7600\",\n" +
                        "      \"2. high\": \"133.0500\",\n" +
                        "      \"3. low\": \"131.6950\",\n" +
                        "      \"4. close\": \"132.9000\",\n" +
                        "      \"5. volume\": \"2369425\"\n" +
                        "    },\n" +
                        "    \"2023-07-07\": {\n" +
                        "      \"1. open\": \"131.7800\",\n" +
                        "      \"2. high\": \"133.8550\",\n" +
                        "      \"3. low\": \"131.7500\",\n" +
                        "      \"4. close\": \"132.0800\",\n" +
                        "      \"5. volume\": \"2982738\"\n" +
                        "    },\n" +
                        "    \"2023-07-06\": {\n" +
                        "      \"1. open\": \"133.2350\",\n" +
                        "      \"2. high\": \"133.9000\",\n" +
                        "      \"3. low\": \"131.5500\",\n" +
                        "      \"4. close\": \"132.1600\",\n" +
                        "      \"5. volume\": \"3508083\"\n" +
                        "    },\n" +
                        "    \"2023-07-05\": {\n" +
                        "      \"1. open\": \"133.3200\",\n" +
                        "      \"2. high\": \"134.3100\",\n" +
                        "      \"3. low\": \"132.5900\",\n" +
                        "      \"4. close\": \"134.2400\",\n" +
                        "      \"5. volume\": \"2955870\"\n" +
                        "    },\n" +
                        "    \"2023-07-03\": {\n" +
                        "      \"1. open\": \"133.4200\",\n" +
                        "      \"2. high\": \"134.3500\",\n" +
                        "      \"3. low\": \"132.8700\",\n" +
                        "      \"4. close\": \"133.6700\",\n" +
                        "      \"5. volume\": \"1477149\"\n" +
                        "    },\n" +
                        "    \"2023-06-30\": {\n" +
                        "      \"1. open\": \"134.6900\",\n" +
                        "      \"2. high\": \"135.0300\",\n" +
                        "      \"3. low\": \"133.4250\",\n" +
                        "      \"4. close\": \"133.8100\",\n" +
                        "      \"5. volume\": \"4236677\"\n" +
                        "    },\n" +
                        "    \"2023-06-29\": {\n" +
                        "      \"1. open\": \"131.7500\",\n" +
                        "      \"2. high\": \"134.3500\",\n" +
                        "      \"3. low\": \"131.6900\",\n" +
                        "      \"4. close\": \"134.0600\",\n" +
                        "      \"5. volume\": \"3639836\"\n" +
                        "    },\n" +
                        "    \"2023-06-28\": {\n" +
                        "      \"1. open\": \"132.0600\",\n" +
                        "      \"2. high\": \"132.1700\",\n" +
                        "      \"3. low\": \"130.9100\",\n" +
                        "      \"4. close\": \"131.7600\",\n" +
                        "      \"5. volume\": \"2753779\"\n" +
                        "    },\n" +
                        "    \"2023-06-27\": {\n" +
                        "      \"1. open\": \"131.3000\",\n" +
                        "      \"2. high\": \"132.9500\",\n" +
                        "      \"3. low\": \"130.8300\",\n" +
                        "      \"4. close\": \"132.3400\",\n" +
                        "      \"5. volume\": \"3219909\"\n" +
                        "    },\n" +
                        "    \"2023-06-26\": {\n" +
                        "      \"1. open\": \"129.3900\",\n" +
                        "      \"2. high\": \"131.4100\",\n" +
                        "      \"3. low\": \"129.3100\",\n" +
                        "      \"4. close\": \"131.3400\",\n" +
                        "      \"5. volume\": \"4845649\"\n" +
                        "    },\n" +
                        "    \"2023-06-23\": {\n" +
                        "      \"1. open\": \"130.4000\",\n" +
                        "      \"2. high\": \"130.6200\",\n" +
                        "      \"3. low\": \"129.1800\",\n" +
                        "      \"4. close\": \"129.4300\",\n" +
                        "      \"5. volume\": \"11324705\"\n" +
                        "    },\n" +
                        "    \"2023-06-22\": {\n" +
                        "      \"1. open\": \"131.6800\",\n" +
                        "      \"2. high\": \"132.9600\",\n" +
                        "      \"3. low\": \"130.6800\",\n" +
                        "      \"4. close\": \"131.1700\",\n" +
                        "      \"5. volume\": \"6013021\"\n" +
                        "    },\n" +
                        "    \"2023-06-21\": {\n" +
                        "      \"1. open\": \"135.1100\",\n" +
                        "      \"2. high\": \"135.3900\",\n" +
                        "      \"3. low\": \"133.2900\",\n" +
                        "      \"4. close\": \"133.6900\",\n" +
                        "      \"5. volume\": \"5501272\"\n" +
                        "    },\n" +
                        "    \"2023-06-20\": {\n" +
                        "      \"1. open\": \"136.3600\",\n" +
                        "      \"2. high\": \"137.2300\",\n" +
                        "      \"3. low\": \"135.8900\",\n" +
                        "      \"4. close\": \"135.9600\",\n" +
                        "      \"5. volume\": \"4272511\"\n" +
                        "    },\n" +
                        "    \"2023-06-16\": {\n" +
                        "      \"1. open\": \"139.2300\",\n" +
                        "      \"2. high\": \"139.4690\",\n" +
                        "      \"3. low\": \"137.4700\",\n" +
                        "      \"4. close\": \"137.4800\",\n" +
                        "      \"5. volume\": \"7473676\"\n" +
                        "    },\n" +
                        "    \"2023-06-15\": {\n" +
                        "      \"1. open\": \"137.2700\",\n" +
                        "      \"2. high\": \"138.8000\",\n" +
                        "      \"3. low\": \"137.1750\",\n" +
                        "      \"4. close\": \"138.4000\",\n" +
                        "      \"5. volume\": \"3812582\"\n" +
                        "    },\n" +
                        "    \"2023-06-14\": {\n" +
                        "      \"1. open\": \"137.8000\",\n" +
                        "      \"2. high\": \"138.9300\",\n" +
                        "      \"3. low\": \"136.9400\",\n" +
                        "      \"4. close\": \"137.2000\",\n" +
                        "      \"5. volume\": \"4514888\"\n" +
                        "    },\n" +
                        "    \"2023-06-13\": {\n" +
                        "      \"1. open\": \"136.5100\",\n" +
                        "      \"2. high\": \"138.1700\",\n" +
                        "      \"3. low\": \"136.0000\",\n" +
                        "      \"4. close\": \"137.6000\",\n" +
                        "      \"5. volume\": \"3927331\"\n" +
                        "    },\n" +
                        "    \"2023-06-12\": {\n" +
                        "      \"1. open\": \"136.0000\",\n" +
                        "      \"2. high\": \"136.6200\",\n" +
                        "      \"3. low\": \"135.8216\",\n" +
                        "      \"4. close\": \"136.4200\",\n" +
                        "      \"5. volume\": \"4500120\"\n" +
                        "    },\n" +
                        "    \"2023-06-09\": {\n" +
                        "      \"1. open\": \"134.3600\",\n" +
                        "      \"2. high\": \"136.1000\",\n" +
                        "      \"3. low\": \"134.1700\",\n" +
                        "      \"4. close\": \"135.3000\",\n" +
                        "      \"5. volume\": \"3981748\"\n" +
                        "    },\n" +
                        "    \"2023-06-08\": {\n" +
                        "      \"1. open\": \"134.6900\",\n" +
                        "      \"2. high\": \"135.9800\",\n" +
                        "      \"3. low\": \"134.0100\",\n" +
                        "      \"4. close\": \"134.4100\",\n" +
                        "      \"5. volume\": \"4128939\"\n" +
                        "    },\n" +
                        "    \"2023-06-07\": {\n" +
                        "      \"1. open\": \"132.5000\",\n" +
                        "      \"2. high\": \"134.4400\",\n" +
                        "      \"3. low\": \"132.1900\",\n" +
                        "      \"4. close\": \"134.3800\",\n" +
                        "      \"5. volume\": \"5772024\"\n" +
                        "    },\n" +
                        "    \"2023-06-06\": {\n" +
                        "      \"1. open\": \"132.4300\",\n" +
                        "      \"2. high\": \"132.9400\",\n" +
                        "      \"3. low\": \"131.8800\",\n" +
                        "      \"4. close\": \"132.6900\",\n" +
                        "      \"5. volume\": \"3297951\"\n" +
                        "    },\n" +
                        "    \"2023-06-05\": {\n" +
                        "      \"1. open\": \"133.1200\",\n" +
                        "      \"2. high\": \"133.5800\",\n" +
                        "      \"3. low\": \"132.2700\",\n" +
                        "      \"4. close\": \"132.6400\",\n" +
                        "      \"5. volume\": \"3993516\"\n" +
                        "    },\n" +
                        "    \"2023-06-02\": {\n" +
                        "      \"1. open\": \"130.3800\",\n" +
                        "      \"2. high\": \"133.1200\",\n" +
                        "      \"3. low\": \"130.1500\",\n" +
                        "      \"4. close\": \"132.4200\",\n" +
                        "      \"5. volume\": \"5375796\"\n" +
                        "    },\n" +
                        "    \"2023-06-01\": {\n" +
                        "      \"1. open\": \"128.4400\",\n" +
                        "      \"2. high\": \"130.1450\",\n" +
                        "      \"3. low\": \"127.7800\",\n" +
                        "      \"4. close\": \"129.8200\",\n" +
                        "      \"5. volume\": \"4136086\"\n" +
                        "    },\n" +
                        "    \"2023-05-31\": {\n" +
                        "      \"1. open\": \"128.5100\",\n" +
                        "      \"2. high\": \"129.4400\",\n" +
                        "      \"3. low\": \"127.4600\",\n" +
                        "      \"4. close\": \"128.5900\",\n" +
                        "      \"5. volume\": \"11086313\"\n" +
                        "    },\n" +
                        "    \"2023-05-30\": {\n" +
                        "      \"1. open\": \"129.5600\",\n" +
                        "      \"2. high\": \"130.0699\",\n" +
                        "      \"3. low\": \"128.2600\",\n" +
                        "      \"4. close\": \"129.4800\",\n" +
                        "      \"5. volume\": \"3741050\"\n" +
                        "    },\n" +
                        "    \"2023-05-26\": {\n" +
                        "      \"1. open\": \"127.0600\",\n" +
                        "      \"2. high\": \"129.6600\",\n" +
                        "      \"3. low\": \"126.8100\",\n" +
                        "      \"4. close\": \"128.8900\",\n" +
                        "      \"5. volume\": \"5612570\"\n" +
                        "    },\n" +
                        "    \"2023-05-25\": {\n" +
                        "      \"1. open\": \"125.6100\",\n" +
                        "      \"2. high\": \"127.2300\",\n" +
                        "      \"3. low\": \"125.0100\",\n" +
                        "      \"4. close\": \"126.7600\",\n" +
                        "      \"5. volume\": \"4102854\"\n" +
                        "    },\n" +
                        "    \"2023-05-24\": {\n" +
                        "      \"1. open\": \"127.8200\",\n" +
                        "      \"2. high\": \"127.9000\",\n" +
                        "      \"3. low\": \"125.4700\",\n" +
                        "      \"4. close\": \"125.6800\",\n" +
                        "      \"5. volume\": \"3915505\"\n" +
                        "    }\n" +
                        "  }\n" +
                        "}", AlphaVantageDailyPrice.class);
            } catch (JsonProcessingException e) {
                throw new RuntimeException(e);
            }
            //TODO: throw error
                if (res == null || res.getMetaData() == null) {
                    System.out.printf("Failed to retrieve daily stock price data: %s from AlphaVantage\n", stock.getSymbol());
                    return;
                }
                boolean firstIteration = true;
                Map<String, TimeSeriesDaily> timeSeriesDailyMap = res.getTimeSeriesDailyMap();
                for (Map.Entry<String, TimeSeriesDaily> entry : timeSeriesDailyMap.entrySet()) {
                    if (firstIteration) {
                        firstIteration = false;
                        continue;
                    }

                    TimeSeriesDaily stockData = entry.getValue();
                    LocalDate formattedDate = LocalDate.parse(entry.getKey());

                    StockDailyPriceRow row = StockDailyPriceRow.builder()
                            .symbol(symbol)
                            .open(stockData.getOpen())
                            .close(stockData.getClose())
                            .high(stockData.getHigh())
                            .low(stockData.getLow())
                            .volume(stockData.getVolume())
                            .timestamp(formattedDate)
                            .build();

                    stockDailyPriceRowList.add(row);
//                InsertStockDailyPriceService insertStockDailyPriceService = new InsertStockDailyPriceService(row);
//                    //TODO: write exceptions
//                try {
//                    insertStockDailyPriceService.insertRecord();
//
//                } catch (SQLException e) {
//                    throw new RuntimeException(e);
//                }
                }

                try {
                    BatchInsertRepository batchInsertRepository = new BatchInsertRepository();
                    Long startTime = System.nanoTime();
                    batchInsertRepository.saveAll(stockDailyPriceRowList);
                    Long endTime = System.nanoTime();
                    Long timeElapse = (endTime - startTime)/1000000000;
                    System.out.printf("Time taken for the batch insert in seconds ---> %d", timeElapse);
                } catch (Exception e) {
                    System.out.println(e.getCause());
                }
        });

    }


}
